# Antibody Structural Descriptor Calculator

This repository contains a pipeline for calculating antibody structural descriptors from PDB files and assigning categorical flags based on empirical thresholds. The descriptors are derived from structural and surface accessibility properties, allowing quantitative assessment of antibody developability.

---

## Features

* Computes a wide range of structural descriptors including:

  * **Charge asymmetry**
  * **Number of charged residues**
  * **Hydrophobic and aromatic SASA**
  * **Hydrophobic Patch Index (PSH)**
  * **Positive/Negative Patch Compactness (PPC/PNC)**
  * **CDR-specific descriptors** (PSH_CDR, PPC_CDR, PNC_CDR)
  * **CDR sequences and lengths** for HCDR1-3 and LCDR1-3
* Classifies descriptors into categorical flags (`green`, `yellow`, `red`) based on quantile thresholds.
* Efficiently processes large antibody structure datasets.
* Supports parallel execution for high-throughput workflows.

---

## Scripts

### 1. `structural_properties_sasa_efficient.awk`

An AWK script that calculates structural descriptors from SASA files generated by `FreeSASA`.

**Usage:**

```bash
awk -v pdb=structure.pdb -f src/structural_properties_sasa_efficient.awk sasa_file.sasa
```

* `pdb` – path to the input PDB structure.
* `sasa_file.sasa` – corresponding SASA file (generated with FreeSASA).
* Output is a CSV-formatted line containing all descriptors and CDR sequences.

---

### 2. Wrapper Script (Bash)

The repository includes a Bash wrapper for batch processing large datasets. The wrapper:

1. Finds all PDB files in a specified directory.
2. Runs **FreeSASA** to compute per-residue SASA.
3. Runs the AWK script to calculate structural descriptors.
4. Appends results to a single CSV file.
5. Supports parallel execution using GNU `parallel`.

**Usage:**
```bash
src/parallel_developability.sh
```

**Notes:**

* Adjust `-j 50` to control the number of parallel jobs according to available CPU cores.
* Update `STRUCTURE_DIR` and `SASA_DIR` to match your dataset paths.
* FreeSASA must be installed and available in the system PATH.

---

## Dependencies

* **GNU AWK** (gawk)
* **FreeSASA** for SASA calculations
* **GNU parallel** for parallel execution (optional but recommended)
* Bash-compatible shell

---

## Output

* **CSV file** containing:

| Column                            | Description                      |
| --------------------------------- | -------------------------------- |
| Filename                          | PDB file name                    |
| ChargeAsymmetry                   | VH-VL charge asymmetry           |
| NCharged                          | Total number of charged residues |
| HydrophobicSASA / AromaticSASA    | SASA contributions               |
| PSH / PPC / PNC                   | Global patch metrics             |
| PSH_CDR / PPC_CDR / PNC_CDR       | CDR-specific patch metrics       |
| HCDR1_seq / HCDR2_seq / HCDR3_seq | Heavy chain CDR sequences        |
| LCDR1_seq / LCDR2_seq / LCDR3_seq | Light chain CDR sequences        |
| *_length                          | Length of corresponding CDR      |

* Values can be further categorized using quantile-based thresholds to generate `green`, `yellow`, `red` flags.

---

## Citation / Reference

* All definitions, formulas, and thresholds are taken from the original antibody structural descriptor article https://www.pnas.org/doi/epdf/10.1073/pnas.1810576116.
* SASA is calculated using the Shrake–Rupley algorithm via FreeSASA.

